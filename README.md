# Stock

**Stock** — это REST API для управления процессами на складе, разработанный с использованием **FastAPI** в рамках тестового задания. API позволяет создавать заказы и карточки товаров, с которыми можно взаимодействовать через соответствующие эндпоинты.

## Технологический стек

- **FastAPI**
- **SQLAlchemy**
- **PostgreSQL**

## Запуск проекта

### Через Docker

1. Клонируйте репозиторий:
    ```bash
    git clone git@github.com:MikhailSavenko/stock.git
    cd stock
    ```
2. Убедитесь, что Docker запущен на вашем компьютере.
3. Создайте файл `.env` в корне проекта и скопируйте туда содержимое из файла `env.txt`.
4. Запустите контейнеры с помощью команды:
    ```bash
    docker-compose up
    ```
5. Откройте документацию API (Swagger/OpenAPI) по адресу:  
   [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)

### Примечание

При первом запуске создаются тестовые данные для объектов **Product**. Вы можете получить список этих товаров по следующему эндпоинту:

- `GET` [http://127.0.0.1:8000/products](http://127.0.0.1:8000/products)

### Без Docker (с использованием SQLite)

1. Клонируйте репозиторий:
    ```bash
    git clone git@github.com:MikhailSavenko/stock.git
    cd stock
    ```
2. Создайте виртуальное окружение:
    ```bash
    python -m venv venv
    source venv/bin/activate  # для Windows используйте venv\Scripts\activate
    ```
3. Установите зависимости:
    ```bash
    pip install -r requirements.txt
    ```
4. Создайте файл `.env` и скопируйте в него данные из `env_sqlite.txt`.
5. Создайте и примените миграции:
    ```bash
    alembic revision --autogenerate
    alembic upgrade head
    ```
6. Запустите приложение:
    ```bash
    uvicorn app.main:app --reload
    ```
7. Откройте документацию API (Swagger/OpenAPI) по адресу:  
   [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)

## Тестирование

Тесты для ключевых методов написаны с использованием **Pytest**. Для запуска тестов выполните следующие шаги:

1. Убедитесь, что вы находитесь в виртуальном окружении и установили все зависимости.
2. Перейдите в директорию с тестами:
    ```bash
    cd tests
    ```
3. Запустите тесты с помощью команды:
    ```bash
    pytest
    ```

Во время тестирования создаётся тестовая база данных, которая очищается после завершения всех тестов.

## Описание API

### Эндпоинты для товаров:

- **Создание товара** — `POST /products`
- **Получение списка товаров** — `GET /products`
- **Получение информации о товаре по ID** — `GET /products/{id}`
- **Обновление информации о товаре** — `PUT /products/{id}`
- **Удаление товара** — `DELETE /products/{id}`

### Эндпоинты для заказов:

- **Создание заказа** — `POST /orders`
- **Получение списка заказов** — `GET /orders`
- **Получение информации о заказе по ID** — `GET /orders/{id}`
- **Обновление статуса заказа** — `PATCH /orders/{id}/status`

### Бизнес-логика:

1. При создании заказа проверяется наличие достаточного количества товара на складе.
2. Количество товара на складе уменьшается при создании заказа.
3. В случае недостаточного количества товара возвращается ошибка с соответствующим сообщением.


